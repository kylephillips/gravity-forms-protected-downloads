var GFPD_DownloadFileSelector=function(){var e=this,t=jQuery;return e.selectors={openBtn:"[data-gfpd-open-media-library]",removeBtn:"[data-gfpd-remove-attachment]"},e.fields={downloadId:"[data-gfpd-download-id]"},e.bindEvents=function(){t(document).on("click",e.selectors.openBtn,function(t){t.preventDefault(),e.openMediaLibrary()}),t(document).on("click",e.selectors.removeBtn,function(t){t.preventDefault(),e.clearField()})},e.openMediaLibrary=function(){if(wp.media.frames.gfpd_frame)return void wp.media.frames.gfpd_frame.open();wp.media.frames.gfpd_frame=wp.media({title:"Select File",multiple:!1,button:{text:"Insert File"}});var t=function(){var t=wp.media.frames.gfpd_frame.state().get("selection");t&&e.populateField(t)};wp.media.frames.gfpd_frame.on("close",t),wp.media.frames.gfpd_frame.open()},e.populateField=function(a){a.each(function(a){var o=a.id,d=a.attributes.title,n=a.attributes.filename,l=(a.attributes.filesizeHumanReadable,a.attributes.url);t(e.fields.downloadId).val(o),t("[data-download-link]").attr("href",l),t("[data-download-filename]").text(n),t("[data-download-title]").text(d),t(".download-meta").removeClass("no-attachment"),t(e.selectors.openBtn).addClass("has-attachment"),t(".gfpd-file-meta").addClass("has-attachment")})},e.clearField=function(){t(e.selectors.openBtn).removeClass("has-attachment"),t(".gfpd-file-meta").removeClass("has-attachment"),t(e.fields.downloadId).val(null),t(".download-meta").addClass("no-attachment")},e.bindEvents()},GFPD_ShortcodeModal=function(){var e=this,t=jQuery;return e.selectors={modalBtn:"[data-add-download-button]",modal:"[data-gfpd-download-modal]",closeModalBtn:"[data-gfpd-close-modal]",insertBtn:"[data-gfpd-insert-download]",list:"[data-gfpd-download-list]",listItem:"[data-gfpd-download-post]",error:"[data-gfpd-download-list-error]"},e.fields={downloadId:"[data-gfpd-download-id]",buttonText:"[data-gfpd-button-text]",css:"[data-gfpd-css]",modalTitle:"[data-gfpd-modal-title]"},e.bindEvents=function(){t(document).on("click",function(a){t(a.target).hasClass("gfpd-modal-overlay")&&e.closeModal()}),t(document).on("click",e.selectors.modalBtn,function(t){t.preventDefault(),e.openModal()}),t(document).on("click",e.selectors.closeModalBtn,function(t){t.preventDefault(),e.closeModal()}),t(document).on("click",e.selectors.insertBtn,function(t){t.preventDefault(),e.insertShortcode()}),t(document).on("click",e.selectors.listItem,function(a){a.preventDefault(),e.populateDownloadId(t(this))})},e.openModal=function(){t(e.selectors.modal).addClass("shown"),e.getDownloads()},e.closeModal=function(){t(e.selectors.modal).removeClass("shown"),t(e.fields.downloadId).val(null),t(e.selectors.listItem).removeClass("selected")},e.populateDownloadId=function(a){var o=t(a).attr("data-gfpd-download-post");t(e.fields.downloadId).val(o),t(e.selectors.listItem).removeClass("selected"),t(a).addClass("selected")},e.getDownloads=function(){t(e.selectors.list).addClass("loading").find("ul").empty(),t(e.selectors.error).hide(),t.ajax({url:gfpd_admin.ajaxurl,type:"post",datatype:"json",data:{action:"gfpd_all_downloads",nonce:gfpd_admin.nonce},success:function(a){return"error"===a.status?(t(e.selectors.error).text(a.message).show(),void t(e.selectors.list).removeClass("loading")):void e.populateList(a.response)}})},e.populateList=function(a){var o="";t.each(a,function(e,t){o+='<li><a href="#" data-gfpd-download-post="'+a[e].id+'">'+a[e].title+"</a></li>"}),t(e.selectors.list).removeClass("loading").find("ul").html(o)},e.insertShortcode=function(){var a=t(e.fields.buttonText).val();""===a&&(a="Download");var o=t(e.fields.downloadId).val(),d=t(e.fields.css).val(),n=t(e.fields.modalTitle).val();""===n&&(n="Download");var l='[download_button download="'+o+'" text="'+a+'" class="'+d+'" modal-title="'+n+'"]';wp.media.editor.insert(l),e.closeModal()},e.bindEvents()};jQuery(document).ready(function(){new GFPD_Bootstrap});var GFPD_Bootstrap=function(){var e=this;jQuery;return e.bootstrap=function(){new GFPD_DownloadFileSelector,new GFPD_ShortcodeModal,e.bindEvents()},e.bindEvents=function(){},e.bootstrap()};