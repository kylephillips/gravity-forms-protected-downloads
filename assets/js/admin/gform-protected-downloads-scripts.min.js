var GFPD_DownloadFileSelector=function(){var e=this,t=jQuery;return e.selectors={openBtn:"[data-gfpd-open-media-library]",removeBtn:"[data-gfpd-remove-attachment]"},e.fields={downloadId:"[data-gfpd-download-id]"},e.bindEvents=function(){t(document).on("click",e.selectors.openBtn,function(t){t.preventDefault(),e.openMediaLibrary()}),t(document).on("click",e.selectors.removeBtn,function(t){t.preventDefault(),e.clearField()})},e.openMediaLibrary=function(){if(wp.media.frames.gfpd_frame)return void wp.media.frames.gfpd_frame.open();wp.media.frames.gfpd_frame=wp.media({title:"Select File",multiple:!1,button:{text:"Insert File"}});var t=function(){var t=wp.media.frames.gfpd_frame.state().get("selection");t&&e.populateField(t)};wp.media.frames.gfpd_frame.on("close",t),wp.media.frames.gfpd_frame.open()},e.populateField=function(o){o.each(function(o){var d=o.id,a=o.attributes.title,l=o.attributes.filename,s=(o.attributes.filesizeHumanReadable,o.attributes.url);t(e.fields.downloadId).val(d),t("[data-download-link]").attr("href",s),t("[data-download-filename]").text(l),t("[data-download-title]").text(a),t(".download-meta").removeClass("no-attachment"),t(e.selectors.openBtn).addClass("has-attachment"),t(".gfpd-file-meta").addClass("has-attachment")})},e.clearField=function(){t(e.selectors.openBtn).removeClass("has-attachment"),t(".gfpd-file-meta").removeClass("has-attachment"),t(e.fields.downloadId).val(null),t(".download-meta").addClass("no-attachment")},e.bindEvents()},GFPD_ShortcodeModal=function(){var e=this,t=jQuery;return e.formActions={downloads:"gfpd_all_downloads",forms:"gfpd_all_forms",fields:"gfpd_form_fields"},e.selectors={modalBtn:"[data-add-download-button]",modal:"[data-gfpd-download-modal]",closeModalBtn:"[data-gfpd-close-modal]",insertBtn:"[data-gfpd-insert-download]",downloadList:"[data-gfpd-download-list]",downloadListItem:"[data-gfpd-download-post]",downloadListError:"[data-gfpd-download-list-error]",formList:"[data-gfpd-form-list]",formListError:"[data-gfpd-form-list-error]",formListItem:"[data-gfpd-form-post]",fieldList:"[data-gfpd-field-list]",fieldListError:"[data-gfpd-field-list-error]",fieldListItem:"[data-gfpd-field-post]"},e.fields={downloadId:"[data-gfpd-download-id]",buttonText:"[data-gfpd-button-text]",css:"[data-gfpd-css]",modalTitle:"[data-gfpd-modal-title]",formId:"[data-gfpd-form-id]",fieldId:"[data-gfpd-field-id]"},e.bindEvents=function(){t(document).on("click",function(o){t(o.target).hasClass("gfpd-modal-overlay")&&e.closeModal()}),t(document).on("click",e.selectors.modalBtn,function(t){t.preventDefault(),e.openModal()}),t(document).on("click",e.selectors.closeModalBtn,function(t){t.preventDefault(),e.closeModal()}),t(document).on("click",e.selectors.insertBtn,function(t){t.preventDefault(),e.insertShortcode()}),t(document).on("click",e.selectors.downloadListItem,function(o){o.preventDefault(),e.populateDownloadId(t(this))}),t(document).on("click",e.selectors.formListItem,function(o){o.preventDefault(),e.populateFormId(t(this))}),t(document).on("click",e.selectors.fieldListItem,function(o){o.preventDefault(),e.populateFieldId(t(this))})},e.openModal=function(){t(e.selectors.modal).addClass("shown"),e.getDownloads(),e.getForms()},e.closeModal=function(){t(e.selectors.modal).removeClass("shown"),t(e.selectors.downloadListItem).removeClass("selected"),t(e.selectors.fieldList).find("ul").empty(),t(e.fields.downloadId).val(null),t(e.fields.formId).val(null),t(e.fields.fieldId).val(null)},e.getDownloads=function(){t(e.selectors.downloadList).addClass("loading").find("ul").empty(),t(e.selectors.downloadListError).hide(),t.ajax({url:gfpd_admin.ajaxurl,type:"post",datatype:"json",data:{action:e.formActions.downloads,nonce:gfpd_admin.nonce},success:function(o){return"error"===o.status?(t(e.selectors.downloadListError).text(o.message).show(),void t(e.selectors.downloadList).removeClass("loading")):void e.populateDownloadList(o.response)}})},e.populateDownloadList=function(o){var d="";t.each(o,function(e,t){d+='<li><a href="#" data-gfpd-download-post="'+o[e].id+'">'+o[e].title+"</a></li>"}),t(e.selectors.downloadList).removeClass("loading").find("ul").html(d)},e.populateDownloadId=function(o){var d=t(o).attr("data-gfpd-download-post");t(e.fields.downloadId).val(d),t(e.selectors.downloadListItem).removeClass("selected"),t(o).addClass("selected")},e.getForms=function(){t(e.selectors.formList).addClass("loading").find("ul").empty(),t(e.selectors.formListError).hide(),t.ajax({url:gfpd_admin.ajaxurl,type:"post",datatype:"json",data:{action:e.formActions.forms,nonce:gfpd_admin.nonce},success:function(o){return"error"===o.status?(t(e.selectors.formListError).text(o.message).show(),void t(e.selectors.formList).removeClass("loading")):void e.populateFormList(o.response)}})},e.populateFormList=function(o){var d="";t.each(o,function(e,t){d+='<li><a href="#" data-gfpd-form-post="'+o[e].id+'">'+o[e].title+"</a></li>"}),t(e.selectors.formList).removeClass("loading").find("ul").html(d)},e.populateFormId=function(o){var d=t(o).attr("data-gfpd-form-post");t(e.fields.formId).val(d),t(e.selectors.formListItem).removeClass("selected"),t(o).addClass("selected"),e.getFields()},e.getFields=function(){t(e.selectors.fieldList).addClass("loading").find("ul").empty(),t(e.selectors.fieldListError).hide(),t.ajax({url:gfpd_admin.ajaxurl,type:"post",datatype:"json",data:{action:e.formActions.fields,nonce:gfpd_admin.nonce,formId:t(e.fields.formId).val()},success:function(o){return"error"===o.status?(t(e.selectors.fieldListError).text(o.message).show(),void t(e.selectors.fieldList).removeClass("loading")):void e.populateFieldList(o.response)}})},e.populateFieldList=function(o){var d="";t.each(o,function(e,t){d+='<li><a href="#" data-gfpd-field-post="'+o[e].id+'">'+o[e].title+"</a></li>"}),t(e.selectors.fieldList).removeClass("loading").find("ul").html(d)},e.populateFieldId=function(o){var d=t(o).attr("data-gfpd-field-post");t(e.fields.fieldId).val(d),t(e.selectors.fieldListItem).removeClass("selected"),t(o).addClass("selected")},e.insertShortcode=function(){var o=t(e.fields.buttonText).val();""===o&&(o="Download");var d=t(e.fields.downloadId).val(),a=t(e.fields.css).val(),l=t(e.fields.modalTitle).val();""===l&&(l="Download");var s=t(e.fields.formId).val(),n=t(e.fields.fieldId).val(),i='[protected_download_button download="'+d+'" text="'+o+'" class="'+a+'" modal-title="'+l+'" form-id="'+s+'" field-id="'+n+'"]';wp.media.editor.insert(i),e.closeModal()},e.bindEvents()};jQuery(document).ready(function(){new GFPD_Bootstrap});var GFPD_Bootstrap=function(){var e=this;jQuery;return e.bootstrap=function(){new GFPD_DownloadFileSelector,new GFPD_ShortcodeModal,e.bindEvents()},e.bindEvents=function(){},e.bootstrap()};